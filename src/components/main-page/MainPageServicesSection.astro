---
import { getCollection } from "astro:content";

const serviceOfferings = (await getCollection("serviceOfferings")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<section class="py-10 md:py-12 bg-gradient-to-b from-white to-gray-50">
  <div class="container mx-auto px-4 sm:px-5">
    <!-- Header -->
    <div class="max-w-2xl mx-auto text-center mb-8 md:mb-10">
      <h2
        class="font-heading text-2xl xs:text-3xl sm:text-4xl md:text-[2.5rem] font-bold bg-gradient-to-r from-slate-900 to-slate-700 text-transparent bg-clip-text mb-3 md:mb-4 leading-tight"
      >
        Services
      </h2>
      <p class="font-sans text-lg sm:text-xl text-gray-600 leading-tight">
        De la crisis a la arquitectura productiva
      </p>
    </div>

    <!-- Services Grid -->
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
      {
        serviceOfferings.map((serviceOffer) => {
          const isEmergency = serviceOffer.data.serviceType === "emergency";
          const isPackage = serviceOffer.data.serviceType === "package";
          const cardColor = isEmergency
            ? "red"
            : isPackage
              ? "emerald"
              : "blue";

          return (
            <a
              href={serviceOffer.data.ctaLink || `/services/${serviceOffer.id}`}
              class={`bg-${cardColor}-50 border-${cardColor}-100 hover:border-${cardColor}-500 p-6 md:p-7 rounded-lg border shadow-lg hover:shadow-xl transition-all hover:scale-[1.01]`}
            >
              <div class="flex flex-col h-full">
                <h3
                  class={`font-heading font-semibold text-${cardColor}-600 mb-3`}
                >
                  {serviceOffer.data.title}
                </h3>
                <p class="font-sans text-base text-gray-700 mb-4 leading-relaxed">
                  {serviceOffer.data.description}
                </p>

                {serviceOffer.data.features && (
                  <ul class="list-disc ml-5 mb-4 text-gray-700 space-y-1">
                    {serviceOffer.data.features.map((feature) => (
                      <li>{feature}</li>
                    ))}
                  </ul>
                )}

                <div class={`pl-3 border-l-2 border-${cardColor}-500 mt-auto`}>
                  <ul class="font-sans text-sm text-gray-600 space-y-2">
                    {serviceOffer.data.packageValue && (
                      <li>
                        <strong>Package Value:</strong> $
                        {serviceOffer.data.packageValue.toLocaleString()}
                        {serviceOffer.data.implementationPricing &&
                          ` (Assessment) | ${serviceOffer.data.implementationPricing} (Implementation)`}
                      </li>
                    )}
                    {serviceOffer.data.pricing &&
                      !serviceOffer.data.packageValue && (
                        <li>
                          <strong>Price:</strong> {serviceOffer.data.pricing}
                        </li>
                      )}

                    {serviceOffer.data.availabilityDate &&
                    serviceOffer.data.availableSlots ? (
                      <li>
                        <strong>Next Available:</strong>{" "}
                        {serviceOffer.data.availabilityDate}
                        {serviceOffer.data.availableSlots > 0 &&
                          ` (${serviceOffer.data.availableSlots} slots remaining)`}
                      </li>
                    ) : serviceOffer.data.availabilityLimit ? (
                      <li>
                        <strong>Availability:</strong>{" "}
                        {serviceOffer.data.availabilityLimit}
                      </li>
                    ) : (
                      <li>
                        <strong>Next Available:</strong>{" "}
                        {new Date(
                          serviceOffer.data.pubDate,
                        ).toLocaleDateString()}
                      </li>
                    )}
                  </ul>
                </div>

                {serviceOffer.data.ctaText && (
                  <div class="mt-5 text-center">
                    <span
                      class={`inline-block py-2 px-4 rounded-md font-medium bg-${cardColor}-600 hover:bg-${cardColor}-700 text-white transition-colors`}
                    >
                      {serviceOffer.data.ctaText}
                    </span>
                  </div>
                )}
              </div>
            </a>
          );
        })
      }
    </div>
  </div>
</section>
